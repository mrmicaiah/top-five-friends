<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Continue with Sean — Top Five Friends</title>
    <meta name="description" content="Choose your plan to keep chatting with Sean Brennan">
    <link rel="icon" type="image/svg+xml" href="https://res.cloudinary.com/dxzw1zwez/image/upload/v1769020728/favicon_mhug2q.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Source+Sans+3:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #c45a3b; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Source Sans 3', -apple-system, sans-serif; background: #f8f6f1; color: #0a0a0a; line-height: 1.6; }
        h1, h2 { font-family: 'Playfair Display', Georgia, serif; font-weight: 600; line-height: 1.2; }
        
        .container { max-width: 900px; margin: 0 auto; padding: 3rem 1.5rem; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; }
        .header { text-align: center; margin-bottom: 3rem; }
        .header h1 { font-size: clamp(2rem, 6vw, 3rem); margin-bottom: 1rem; }
        .header p { font-size: 1.1rem; color: #6b6560; }
        
        .pricing-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .pricing-card { background: white; border: 2px solid #d4d0c8; padding: 2rem; cursor: pointer; transition: all 0.3s; }
        .pricing-card:hover { border-color: var(--accent); transform: translateY(-2px); box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .pricing-card.selected { border-color: var(--accent); background: rgba(196, 90, 59, 0.05); position: relative; }
        .pricing-card.selected::after { content: "✓"; position: absolute; top: 1rem; right: 1rem; width: 28px; height: 28px; background: var(--accent); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; }
        
        .badge { background: #0a0a0a; color: #f8f6f1; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; padding: 0.4rem 0.8rem; margin-bottom: 1rem; display: inline-block; }
        .pricing-name { font-family: 'Playfair Display', serif; font-size: 1.3rem; margin-bottom: 0.5rem; }
        .pricing-price { margin: 1.5rem 0; }
        .pricing-price .amount { font-family: 'Playfair Display', serif; font-size: 2.5rem; font-weight: 700; }
        .pricing-price .period { color: #6b6560; font-size: 0.9rem; }
        .savings { display: inline-block; background: rgba(45, 106, 79, 0.1); color: #2d6a4f; font-size: 0.75rem; font-weight: 600; padding: 0.3rem 0.6rem; border-radius: 3px; margin-bottom: 1rem; }
        .features { list-style: none; text-align: left; margin: 1.5rem 0; padding-top: 1.5rem; border-top: 1px solid #d4d0c8; }
        .features li { padding: 0.5rem 0; font-size: 0.9rem; color: #6b6560; display: flex; align-items: flex-start; gap: 0.5rem; }
        .features li::before { content: "✓"; color: var(--accent); font-weight: 600; flex-shrink: 0; }
        
        .cta-section { text-align: center; margin-top: 2rem; }
        .subscribe-btn { display: inline-block; background: var(--accent); color: white; padding: 1.25rem 3rem; font-size: 1.1rem; font-weight: 600; border: none; cursor: pointer; transition: all 0.3s; text-decoration: none; }
        .subscribe-btn:hover { background: #0a0a0a; transform: translateY(-2px); }
        .subscribe-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        .loading { display: none; margin-top: 1rem; color: #6b6560; font-size: 0.9rem; }
        .loading.active { display: block; }
        .error { display: none; margin-top: 1rem; padding: 1rem; background: #fee; border: 1px solid #fcc; color: #c33; border-radius: 4px; font-size: 0.9rem; }
        .error.active { display: block; }
        
        @media (max-width: 768px) {
            .container { padding: 1.5rem 1rem; }
            .pricing-grid { grid-template-columns: 1fr; }
            .subscribe-btn { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Continue with Sean</h1>
            <p>Choose your plan to keep the conversation going</p>
        </div>
        
        <div class="pricing-grid">
            <div class="pricing-card" data-plan="monthly" data-price-id="price_1SsVUgHSBCQi9g6mVhNe8FyC">
                <span class="badge">Flexible</span>
                <h2 class="pricing-name">Monthly</h2>
                <div class="pricing-price">
                    <span class="amount">$29.99</span>
                    <span class="period">/month</span>
                </div>
                <ul class="features">
                    <li>Unlimited messaging</li>
                    <li>Full conversation memory</li>
                    <li>Cancel anytime</li>
                    <li>Switch mentors anytime</li>
                </ul>
            </div>
            
            <div class="pricing-card" data-plan="yearly" data-price-id="price_1SsVUoHSBCQi9g6m3AjIGNzK">
                <span class="badge">Best Value</span>
                <h2 class="pricing-name">Annual</h2>
                <div class="pricing-price">
                    <span class="amount">$299.99</span>
                    <span class="period">/year</span>
                </div>
                <span class="savings">Save $60 (2 months free)</span>
                <ul class="features">
                    <li>Everything in Monthly</li>
                    <li>17% discount</li>
                    <li>Lock in current pricing</li>
                    <li>Priority support</li>
                </ul>
            </div>
        </div>
        
        <div class="cta-section">
            <button id="subscribeBtn" class="subscribe-btn" disabled>Select a Plan Above</button>
            <p class="loading" id="loading">Creating your checkout session...</p>
            <div class="error" id="error"></div>
        </div>
    </div>
    
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');
        const email = urlParams.get('email');
        const chatId = urlParams.get('chat_id');
        
        if (!token || !email) {
            document.getElementById('error').textContent = 'Invalid signup link. Please request a new one from Sean.';
            document.getElementById('error').classList.add('active');
        }
        
        let selectedPlan = null;
        const cards = document.querySelectorAll('.pricing-card');
        const subscribeBtn = document.getElementById('subscribeBtn');
        
        cards.forEach(card => {
            card.addEventListener('click', () => {
                cards.forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                selectedPlan = {
                    type: card.dataset.plan,
                    priceId: card.dataset.priceId
                };
                subscribeBtn.disabled = false;
                subscribeBtn.textContent = `Subscribe ${card.dataset.plan === 'monthly' ? 'Monthly' : 'Annually'}`;
            });
        });
        
        subscribeBtn.addEventListener('click', async () => {
            if (!selectedPlan || !token || !email) return;
            
            subscribeBtn.disabled = true;
            document.getElementById('loading').classList.add('active');
            document.getElementById('error').classList.remove('active');
            
            try {
                const response = await fetch('https://companion-accounts.micaiah-tasks.workers.dev/subscription/create-checkout', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: email,
                        priceId: selectedPlan.priceId,
                        tier: 1,
                        characters: ['sean'],
                        chatId: chatId,
                        character: 'sean',
                        successUrl: 'https://topfivefriends.com/success?character=sean',
                        cancelUrl: `https://topfivefriends.com/cancel?token=${token}&email=${email}&chat_id=${chatId || ''}&character=sean`
                    })
                });
                
                const data = await response.json();
                
                if (data.url) {
                    window.location.href = data.url;
                } else {
                    throw new Error(data.error || 'Failed to create checkout session');
                }
            } catch (error) {
                console.error('Checkout error:', error);
                document.getElementById('error').textContent = error.message || 'Something went wrong. Please try again.';
                document.getElementById('error').classList.add('active');
                document.getElementById('loading').classList.remove('active');
                subscribeBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
